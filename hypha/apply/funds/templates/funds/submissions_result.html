{% extends "funds/base_submissions_table.html" %}
{% load i18n static apply_tags %}
{% block title %}{% trans "Submissions results" %}{% endblock %}

{% block content %}

    {% adminbar %}
        {% slot header %}{% trans "Submissions results" %}{% endslot %}
        {% slot sub_heading %}{% trans "Track and explore submission results" %}{% endslot %}
    {% endadminbar %}

    <div class="wrapper wrapper--large wrapper--inner-space-medium">
        <section class="wrapper wrapper--bottom-space">
            <h3>{% trans "Summary" %}</h3>
            <div class="prose max-w-none grid grid-cols-[repeat(auto-fit,minmax(250px,1fr))] gap-8">
                <div class="border p-4 shadow">
                    <h5>{% trans "Amounts" %}</h5>
                    <table class="mb-0 mt-2">
                        <tr class="text-fg-muted">
                            <th class="pb-2 text-center">{% trans "Applied" %} ({% get_currency_symbol %})</th>
                            <th class="pb-2 text-center">{% trans "Accepted" %}  ({% get_currency_symbol %})</th>
                        </tr>
                        <tr class="text-xl font-semibold">
                            <td class="pt-2 text-center">{{ submission_sum|default:"0"|format_number_as_currency }}</td>
                            <td class="pt-2 text-center">{{ submission_accepted_sum|default:"0"|format_number_as_currency }}</td>
                        </tr>
                    </table>
                </div>
                <div class="border p-4 shadow">
                    <h5>{% trans "Submissions" %}</h5>
                    <table class="mb-0 mt-2 table-fixed">
                        <tr class="text-fg-muted">
                            <th class="pb-2 text-center">{% trans "Applied" %}</th>
                            <th class="pb-2 text-center">{% trans "Accepted" %}</th>
                            <th class="pb-2 text-center">{% trans "Pending" %}</th>
                        </tr>
                        <tr class="text-xl font-semibold">
                            <td class="pt-2 text-center">{{ object_list.count }}</td>
                            <td class="pt-2 text-center">{{ submission_accepted_count|default:"0" }}</td>
                            <td class="pt-2 text-center">{{ submission_undetermined_count|default:"0" }}</td>
                        </tr>
                    </table>
                </div>
                <div class="border p-4 shadow">
                    <h5>{% trans "Reviews" %}</h5>
                    <table class="mb-0 mt-2 table-fixed">
                        <tr class="text-fg-muted">
                            <th class="pb-2 text-center">{% trans "All" %}</th>
                            <th class="pb-2 text-center">{% trans "You" %}</th>
                            <th class="pb-2 text-center">{% trans "Your avg. score" %}</th></tr>
                        <tr class="text-xl font-semibold">
                            <th class="pt-2 text-center">{{ review_count|default:"0" }}</td>
                            <th class="pt-2 text-center">{{ review_my_count|default:"0" }}</td>
                            <th class="pt-2 text-center">{{ review_my_score|floatformat:"0"|default:"0" }}</td>
                        </tr>
                    </table>
                </div>
            </div>
        </section>

        <section class="wrapper wrapper--bottom-space">
            <h3>{% trans "Submission value totals" %}</h3>

            {% include "funds/includes/table_filter_and_search.html" with filter_form=filter_form search_term=search_term filter_action=filter_action use_batch_actions=False filter_classes="filters-open" %}

            <div class="grid grid-cols-[repeat(auto-fit,minmax(250px,1fr))] gap-8">
                <div class='border shadow p-4 flex flex-col gap-4'>
                    <span>{% trans "Number of submissions" %}</span>
                    <span class="text-2xl font-semibold">
                        {{ count_values }}<sup>{% if not count_values == object_list.count %}*{% endif %}</sup>
                    </span>
                </div>
                <div class='border shadow p-4 flex flex-col gap-4'>
                    <span>{% trans "Average value" %}</span>
                    <span class="text-2xl font-semibold">
                        {{ average_value|format_number_as_currency }}
                    </span>
                </div>
                <div class='border shadow p-4 flex flex-col gap-4'>
                    <span>{% trans "Total value" %}</span>
                    <span class="text-2xl font-semibold">
                        {{ total_value|format_number_as_currency }}
                    </span>

                </div>
            </div>
            {% if not count_values == object_list.count %}
                {% with object_list.count|subtract:count_values as count_diff %}
                    <p class="text-xs text-fg-muted">
                        {% blocktrans %}*{{ count_diff }} submission(s) lack requested amount fields or data and are not included.{% endblocktrans %}
                    </p>
                {% endwith %}
            {% endif %}
        </section>
    </div>
{% endblock %}

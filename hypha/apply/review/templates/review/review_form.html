{% extends "base-apply.html" %}
{% load i18n static %}
{% block title %}{{ title }}{% endblock %}
{% block content %}

    {% adminbar %}
        {% slot header %}{{ title }}{% endslot %}
        {% slot sub_heading %}
            {% trans "For" %} <a href="{% url "funds:submissions:detail" submission.id %}">{{ submission.title }}</a>
        {% endslot %}
    {% endadminbar %}

    {% include "forms/includes/form_errors.html" with form=form %}

    <div class="wrapper wrapper--medium wrapper--inner-space-medium wrapper--flex">
        {% if not has_submitted_review %}
            <form class="form form--with-p-tags form--scoreable form--width" action="" method="post">
                {{ form.media }}
                {% csrf_token %}

                {% for hidden in form.hidden_fields %}
                    {{ hidden }}
                {% endfor %}

                {% for field in form.visible_fields %}
            {# to be replaced with better logic when we use stream form #}
                    {% ifchanged field.field.group %}
                        {% for key, value in form.titles.items %}
                            {% if key == field.field.group %}
                                <h2>{{ value }}</h2>
                            {% endif %}
                        {% endfor %}
                    {% endifchanged %}

                    {% if field.field %}
                        {% include "forms/includes/field.html" %}
                    {% else %}
                        {{ field.block }}
                    {% endif %}
                {% endfor %}
                {% if not object.id or object.is_draft %}
                    <button class="button button--submit button--top-space button--white" type="submit" name="{{ form.draft_button_name }}" formnovalidate>{% trans "Save draft" %}</button>
                {% endif %}
                <button class="button button--submit button--top-space button--primary" type="submit" name="submit">{% trans "Submit" %}</button>
            </form>
        {% else %}
            <p>{% trans "You have already posted a review for this submission" %}</p>
        {% endif %}
        <div class="form--score-box">{% trans "Score:" %} <span class="score-number">0</span> <button class="zeta button button--secondary" style="padding: 0.2rem; margin: 0.2rem">{% trans "Tot|Avg" %}<br /></button></div>
    </div>
{% endblock %}
{% block extra_js %}
    <script src="{% static 'js/review-form-score.js' %}"></script>
{% endblock %}

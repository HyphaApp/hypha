{% extends "two_factor/_base_focus.html" %}
{% load i18n users_tags %}

{% block content %}
  <p class="actions actions-header"><a href="{% url 'users:account' %}" class="link link--bold">{% trans "Back to Account" %}</a></p>
  <h1>{% block title %}{% trans "Backup Codes" %}{% endblock %}</h1>
  <p>{% blocktrans trimmed %}Each of the code can be used only once. When they are used up, you can generate a new set of backup codes.{% endblocktrans %}</p>

  {% if device.token_set.count %}
<textarea readonly cols="8" rows="{{ device.token_set.count }}" id="list-backup-tokens">{% for token in device.token_set.all %}{{ token.token }}{% if not forloop.last %}&#013;&#010;{% endif %}{% endfor %}</textarea>
    <p class="hide-print">{% blocktrans %}You should now print these codes or copy them to your
       clipboard and store them in your password manager.{% endblocktrans %}</p>

    <p class="hide-print">{% blocktrans %}Once done, then click next.{% endblocktrans %}</p>

    <form method="post" class="actions actions-footer">{% csrf_token %}{{ form }}
    <p>
        <a href="#" class="btn btn-primary btn-print">{% trans "Print" %}</button>
        <button class="btn btn-primary" type="submit">{% trans "Regenerate Codes" %}</button>
        <style>
        @media print {
            .header, .admin-bar, .actions, .hide-print {
                display: none;
            }
        }
        </style>
        <script>
        var el = $('#list-backup-tokens');
        el.on("click", function (){
            el.select();
        });

        $(".btn-print").on("click", function(e){
            e.preventDefault();
            window.print();
        })

        </script>
    </p>
        <a class="btn btn-link" href="#">{% trans "Next" %}</a>
        {# <a class="btn btn-link link--left-space" href="data:text/plain;charset=UTF-8,{% tokens_text device.token_set.all %}" download="backup_codes.txt">{% trans "Save Codes" %}</a> #}
    </form>
  {% else %}
    <p>{% trans "You don't have any backup codes yet." %}</p>
      <form method="post">{% csrf_token %}{{ form }}
        <button class="btn btn-primary" type="submit">{% trans "Generate Codes" %}</button>
      </form>
  {% endif %}

{% endblock %}

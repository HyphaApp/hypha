{% extends 'reset_network/base.html' %}
{% load i18n two_factor %}

{% block body_class %}base-dark{% endblock %}
{% block page_title %}Login{% endblock %}
{% block title %}Login{% endblock %}
{% block content %}

<section class="para para--login theme-dark" data-section-theme="dark">
  <div class="para__wrap contain reveal">
    <div class="para__content">
      <div class="para__title">
        <h1>Login</h1>
      </div>
      <div class="para__body">
        <form class="form" method="post">
          {% csrf_token %}

          <div class="form-summary">
            {% if form.non_field_errors %}

              {% for error in form.non_field_errors %}
                <p class="form-err-txt">{{ error }}</p>
              {% endfor %}

            {% else %}

              {% if wizard.steps.current == 'token' %}
                {% if device.method == 'call' %}
                  <p>We are calling your phone right now, please enter the digits you hear.</p>
                {% elif device.method == 'sms' %}
                  <p>We sent you a text message, please enter the tokens we sent.</p>
                {% else %}
                  <p>Please enter the tokens generated by your token generator.</p>
                {% endif %}
              {% elif wizard.steps.current == 'backup' %}
                <p>Use this form for entering backup tokens for logging in. These tokens have been generated for you to print and keep safe. Please enter one of these backup tokens to login to your account.</p>
              {% else %}
                <p>Enter your credentials.</p>
              {% endif %}

            {% endif %}
          </div>

          {{ wizard.management_form }}
          {% if wizard.steps.current == 'auth' %}

            {% for field in form %}
              <div class="form-row">
                <div class="input">
                  <label class="input__label" for="{{ field.id_for_label }}">{{ field.label }}</label>
                  <div class="input__wrap textbox">
                    {{ field }}
                    <div class="textbox__focus"></div>
                  </div>
                </div>
              </div>
            {% endfor %}

            <div class="form-row">
              <button class="button" type="submit">
                <span class="button__drop"></span>
                <span class="button__label">Login</span>
              </button>
            </div>

            <div class="form-row">

              <p>
                <a href="{% url 'users:password_reset' %}">Forgot your password?</a>
              </p>

              {% else %}

                {% for field in wizard.form %}
                  <div class="form-row">
                    <div class="input">
                      <label class="input__label" for="{{ field.id_for_label }}">{{ field.label }}</label>
                      <div class="input__wrap textbox">
                        {{ field }}
                        <div class="textbox__focus"></div>
                      </div>
                      {% for error in field.errors %}
                        <p class="form-field-err-txt">{{ error }}</p>
                      {% endfor %}
                    </div>
                  </div>
                {% endfor %}

                {# hidden submit button to enable [enter] key #}
                <div style="margin-left: -9999px"><input type="submit" value=""/></div>

                {% if other_devices %}
                  <p>Or, alternatively, use one of your backup phones:
                    {% for other in other_devices %}
                    <button name="challenge_device" value="{{ other.persistent_id }}" class="form-btn-u" type="submit">
                      {{ other|device_action }}
                    </button>
                  {% endfor %}</p>
                {% endif %}

                {% if backup_tokens %}
                  <p>As a last resort, you can use a backup token:
                    <button name="wizard_goto_step" type="submit" value="backup" class="form-btn-u">Use Backup Token</button>
                  </p>
                {% endif %}

                <p>{% include "two_factor/_reset_network_wizard_actions.html" %}</p>

              {% endif %}
            </form>

            {% if wizard.steps.current == 'auth' %}
              <p>
                <a href="{% url "social:begin" "google-oauth2" %}{% if next %}?next={{ next }}{% endif %}">Log in with your {{ ORG_SHORT_NAME }} email</a>
              </p>
            {% endif %}

        </div>
      </div>
    </div>
  </div>
</section>

{% endblock %}

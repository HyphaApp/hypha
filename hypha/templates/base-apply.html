{% load i18n static wagtailcore_tags wagtailimages_tags util_tags hijack cookieconsent_tags %}<!doctype html>
{% wagtail_site as current_site %}
{% get_current_language as LANGUAGE_CODE %}
{% get_current_language_bidi as LANGUAGE_BIDI %}
<html class="no-js" lang="{{ LANGUAGE_CODE }}" dir="{% if LANGUAGE_BIDI %}rtl{% else %}ltr{% endif %}">
    <head>
        {# TODO fallbacks if page is not defined e.g. for 404 page #}
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width">
        <title>{% block title_prefix %}{% if current_site.site_name %}{{ current_site.site_name }} | {% endif %}{% endblock %}{% block title %}{% if page.seo_title %}{{ page.seo_title }}{% else %}{{ page.title }}{% endif %}{% endblock %}{% block title_suffix %}{{ TITLE_SUFFIX }}{% endblock %}</title>
        <meta name="description" content="{% if page.search_description %}{{ page.search_description }}{% else %}{{ page.listing_summary }}{% endif %}">

        <!-- favicons -->
        {% comment %}
            Generate favicons by https://realfavicongenerator.net using the following path: settings.STATIC_URL + images/favicons. Override favicons by adding them to public/images/favicons.
        {% endcomment %}
        <meta name="msapplication-TileColor" content="#da532c">
        <meta name="msapplication-TileImage" content="{% static 'images/favicons/mstile-150x150.png' %}">
        <meta name="theme-color" content="#ffffff">
        <link rel="apple-touch-icon" href="{% static 'images/favicons/apple-touch-icon.png' %}">
        <link rel="icon" type="image/png" sizes="32x32" href="{% static 'images/favicons/favicon-32x32.png' %}">
        <link rel="icon" type="image/png" sizes="16x16" href="{% static 'images/favicons/favicon-16x16.png' %}">
        <link rel="manifest" href="{% static 'images/favicons/site.webmanifest' %}">
        <link rel="mask-icon" href="{% static 'images/favicons/safari-pinned-tab.svg' %}" color="#5bbad5">
        <link rel="shortcut icon" href="{% static 'images/favicons/favicon.ico' %}">

        <link rel="stylesheet" href="{% static 'css/tailwind-output.css' %}">
        <link rel="stylesheet" href="{% static 'css/apply/main.css' %}">
        {% block extra_css %}{% endblock %}
        <link rel="stylesheet" href="{% static 'css/print.css' %}" media="print">

        {% comment %}Detect if javascript is enabled; helps with styling{% endcomment %}
        <script>document.querySelector("html").classList.replace("no-js", "js")</script>

        <!-- htmx start: installed with npm -->
        <script src="{% static 'js/apply/vendor/htmx.min.js' %}"></script>
        <script src="{% static 'js/apply/vendor/htmx-ext-multi-swap.min.js' %}"></script>
        {% comment %} <script src="{% static 'js/apply/vendor/htmx-ext-alpine-morph.min.js' %}" defer></script> {% endcomment %}
        <script src="{% static 'js/apply/vendor/nprogress-2.0.0.min.js' %}" defer></script>
        <script>
            window.addEventListener('DOMContentLoaded', (event) => {
                document.addEventListener("htmx:beforeRequest", function() { NProgress.start(); });
                document.addEventListener("htmx:afterRequest", function() { NProgress.done(); });
            });
            {% comment %}
            If the htmx response is either 403, 404, or 500, display the error page.
            Please note that the error replaces the entire page, rather than displaying
            the error response in the target element.
            https://stackoverflow.com/a/74823597/782901
            {% endcomment %}
            document.addEventListener("htmx:beforeOnLoad", function (event) {
                const xhr = event.detail.xhr
                if (xhr.status == 500 || xhr.status == 403 || xhr.status == 404) {
                    event.stopPropagation() // Tell htmx not to process these requests
                    document.children[0].innerHTML = xhr.response // Swap in body of response instead
                }
            });
        </script>
        <!-- htmx end -->

        <script src="{% static 'js/jquery.min.js' %}"></script>
        <script src="{% static 'js/js.cookie.min.js' %}"></script>

        <!-- alpine js start -->
        <style> [x-cloak] {display: none !important} </style>
        <!-- Alpine Plugins: installed with npm -->
        <script defer src="{% static 'js/apply/vendor/alpine-focus.min.js' %}"></script>

        <!-- Alpine Core: installed with npm  -->
        <script defer src="{% static 'js/apply/vendor/alpine.min.js' %}"></script>
        <!-- alpine.js end -->

        <!-- modules -->
        <script type="module" src="{% static 'js/esm/github-relative-time-element-4-3-0.js' %}"></script>
        <script type="module" src="{% static 'js/esm/github-filter-input-element-0-1-1.js' %}"></script>
    </head>

    <body
        hx-ext="multi-swap"
        hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
        class="antialiased {% block body_class %}template-{{ page.get_verbose_name|slugify }}{% endblock %}"
    >

        {% include "includes/sprites.html" %}

        {% include 'includes/messages.html' %}
        <header class="header">

            <div class="header__inner wrapper wrapper--large">
                <a href="{{ settings.utils.SystemMessagesSettings.site_logo_link|default:"/" }}" aria-label="Home link">
                    {% if settings.utils.SystemMessagesSettings.site_logo_default %}
                        {% image settings.utils.SystemMessagesSettings.site_logo_default width-215 as logo_default %}
                        <img class="header__logo header__logo--desktop"
                             width="215"
                             src="{{ logo_default.url }}"
                             alt="{{ settings.utils.SystemMessagesSettings.site_logo_default.alt }}"
                        >
                        {% if settings.utils.SystemMessagesSettings.site_logo_mobile %}
                            {% image settings.utils.SystemMessagesSettings.site_logo_mobile width-60 as logo_mobile %}
                            <img class="header__logo header__logo--mobile"
                                 width="60"
                                 src="{{ logo_mobile.url }}"
                                 alt="{{ settings.utils.SystemMessagesSettings.site_logo_mobile.alt }}"
                            >
                        {% else %}
                            <img class="header__logo header__logo--mobile"
                                 width="60"
                                 src="{{ logo_default.url }}"
                                 alt="{{ settings.utils.SystemMessagesSettings.site_logo_default.alt }}"
                            >
                        {% endif %}
                    {% else %}
                        <img class="header__logo header__logo--desktop"
                             width="215"
                             height="40"
                             src="{% static 'images/logo.png' %}"
                             alt="Hypha logo"
                        >
                        <img class="header__logo header__logo--mobile"
                             width="60" height="60"
                             src="{% static 'images/logo-small.png' %}"
                             alt="Hypha logo"
                        >
                    {% endif %}
                </a>

                <div class="header__inner header__inner--mobile-buttons">
                    <button class="button button--left-space js-mobile-menu-toggle" aria-haspopup="true">
                        <svg class="icon icon--mobile-menu"><use xlink:href="#mobile-menu-toggle"></use></svg>
                    </button>
                </div>

                <section class="header__menus header__menus--desktop">
                    {% if settings.utils.SystemMessagesSettings.nav_content %}
                        {{ settings.utils.SystemMessagesSettings.nav_content|safe }}
                    {% else %}
                        {% include "navigation/primarynav-apply.html" %}
                    {% endif %}

                </section>

                <section class="header__menus header__menus--mobile">
                    <div class="header__inner header__inner--menu-open">
                        <a href="{{ settings.utils.SystemMessagesSettings.site_logo_link|default:"/" }}" aria-label="Home link">
                            {% if settings.utils.SystemMessagesSettings.site_logo_mobile %}
                                {% image settings.utils.SystemMessagesSettings.site_logo_mobile width-60 as logo_mobile %}
                                <img class="header__logo header__logo--mobile"
                                     width="60"
                                     src="{{ logo_mobile.url }}"
                                     alt="{{ settings.utils.SystemMessagesSettings.site_logo_mobile.alt }}"
                                >
                            {% else %}
                                <img class="header__logo header__logo--mobile"
                                     width="60"
                                     height="60"
                                     src="{% static 'images/logo-small.png' %}"
                                     alt="Hypha logo"
                                >
                            {% endif %}
                        </a>
                        <div class="header__inner header__inner--mobile-buttons">
                            <button class="button button--left-space js-mobile-menu-close">
                                <svg class="header__icon header__icon--cross icon icon--mobile-menu"><use xlink:href="#cross"></use></svg>
                            </button>
                        </div>
                    </div>

                    {% if settings.utils.SystemMessagesSettings.nav_content %}
                        {{ settings.utils.SystemMessagesSettings.nav_content|safe }}
                    {% else %}
                        {% include "navigation/primarynav-apply.html" %}
                    {% endif %}

                    {% if request.user.is_authenticated %}
                        <a href="{% url 'users:account' %}" class="link link--button-transparent link--mobile-standout">
                            <svg class="icon"><use xlink:href="#person-icon"></use></svg>
                            {{ request.user }}
                        </a>
                        <a href="{% url 'users_public:logout' %}" class="link link--button-transparent link--mobile-standout">{% trans "Log out" %}</a>
                    {% endif %}
                </section>

                <div class="header__button-container">
                    {% if latest_notifications %}
                        <div x-data="{open: false}">
                            <a href="{% url "activity:notifications" %}"
                               class="button button--contains-icons notifications__bell"
                               aria-label="{% trans "Notifications" %}"
                               aria-haspopup="activity"
                               aria-expanded="false"
                               role="button"
                               @click.prevent="open = ! open"
                            >
                                <svg class="icon"><use xlink:href="#bell-icon"></use></svg>
                            </a>
                            <div x-cloak x-show="open" x-transition @click.outside="open = false">{% include "activity/include/notifications_dropdown.html" %}</div>
                        </div>
                    {% endif %}
                    {% if request.user.is_authenticated %}
                        <a href="{% url 'users:account' %}" class="button button--transparent button--narrow button--contains-icons" hx-boost="true">
                            <svg class="icon icon--person"><use xlink:href="#person-icon"></use></svg>
                            {{ request.user }}
                        </a>
                        <a href="{% url 'users_public:logout' %}" class="button button--transparent button--narrow">
                            {% trans "Log out" %}
                        </a>
                    {% else %}
                        {% if request.path != '/auth/' %}
                            {% include "utils/includes/login_button.html" %}
                        {% endif %}
                        {% if ENABLE_PUBLIC_SIGNUP and request.path != '/register/' %}
                            {% include "utils/includes/register_button.html" %}
                        {% endif %}
                    {% endif %}
                </div>
            </div>
        </header>

        {% block content_wrapper %}
            <main class="wrapper wrapper--large wrapper--main" id="main">
                {% block content %}{% endblock %}
            </main>
        {% endblock %}

        <footer class="footer"></footer>

        {% block scroll_to_top %}
            {% #scroll-to-top %}
        {% endblock scroll_to_top %}

        {% cookie_banner %}

        <script src="{% static 'js/main.js' %}"></script>
        <script src="{% static 'js/cookieconsent.js' %}"></script>
        <!-- Tooltips -->
        <script src="{% static 'js/tooltips/popper.min.js' %}"></script>
        <script src="{% static 'js/tooltips/tippy.min.js' %}"></script>
        <script>
            htmx.onLoad(function() {
                tippy('[data-tippy-content]');
            });
        </script>
        <!-- Tooltips end -->

        <!-- Datetime picker-->
        <script src="{% static 'js/apply/vendor/moment.min.js' %}"></script>
        <script src="{% static 'js/apply/vendor/daterangepicker.min.js' %}"></script>

        {% block extra_js %}{% endblock %}

        {% block sentry_sdk %}
            {% if SENTRY_PUBLIC_KEY %}
                <script
                    src="https://js.sentry-cdn.com/{{ SENTRY_PUBLIC_KEY }}.min.js"
                    crossorigin="anonymous"
                ></script>
                <script>
                    Sentry.onLoad(function() {
                        Sentry.init({
                            environment: "{{ SENTRY_ENVIRONMENT }}",
                            debug: {% if SENTRY_DEBUG %}true{% else %}false{% endif %},
                            integrations: [new BrowserTracing()],
                            denyUrls: {{ SENTRY_DENY_URLS|safe }},
                            tracesSampleRate: {{ SENTRY_TRACES_SAMPLE_RATE }}
                        });
                    });
                </script>
            {% endif %}
        {% endblock sentry_sdk %}
    </body>
</html>

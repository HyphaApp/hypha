{% extends "base.html" %}
{% load i18n static wagtailcore_tags wagtailimages_tags heroicons %}<!doctype html>

{% block header %}
    <header
        class="px-4 flex gap-4 items-center justify-between max-w-7xl mx-auto w-full"
        x-data="{'showDesktopMenu': false, isDesktop: false, mm: null}"
        x-init="mm = window.matchMedia(`(min-width: 768px)`); isDesktop = mm.matches; mm.addListener((e) => { isDesktop = e.matches }); "
    >
        <a
            class="py-4"
            href="{{ settings.core.SystemSettings.site_logo_link|default:"/" }}">
            {% include 'includes/header-logo.html' %}
        </a>

        {% block header_menu %}
            {% if request.user.is_authenticated %}
                {% include "core/navigation/primarynav-apply.html" %}
            {% endif %}
        {% endblock %}

        <div class="flex gap-2">
            {% if request.user.is_authenticated and request.user.is_apply_staff %}
                <!-- Notification Bell -->
                <div
                    class="relative inline-block"
                    x-data="{open: false}"
                    x-on:keydown.escape="open = false"
                    x-init="$watch('open', value => { if (value) { document.getElementById('id-task-list').dispatchEvent(new Event('htmx:fetch')); } })"
                >
                    <a href="{% url "todo:list" %}"
                       class="flex p-2 rounded-full transition-all group text-gray-900"
                       aria-label="{% trans "Task List" %}"
                       aria-haspopup="task_list"
                       aria-expanded="false"
                       role="button"
                       title="{% trans "Click to open your task list" %}"
                       @click.prevent="open = ! open"
                       :class="open ? 'bg-gray-900 text-white' : 'hover:bg-light-blue/30'"
                    >
                        {% heroicon_outline "bell-alert" class="inline group-hover:scale-110 transition-transform" aria_hidden="true" %}
                    </a>

                    <!-- panel -->
                    <div
                        class="z-30 shadow-md bg-white border overflow-y-scroll rounded fixed top-0 start-0 end-0 md:absolute md:start-auto md:top-auto md:min-w-[400px] md:max-h-[500px]"
                        x-cloak
                        x-show="open"
                        x-trap="open"
                        x-transition
                        x-transition.origin.top
                        @click.outside="open = false"
                        class="relative "
                        role="task_list"
                    >
                        <header class="subheading border-b px-3 py-2 flex justify-between items-center gap-2 bg-gray-100">
                            <span class="SubMenuHeading font-medium text-inherit">
                                {% trans "Your Tasks" %}
                            </span>
                            <button type="button" @click='open = false' class="appearance-none">
                                {% heroicon_solid "x-mark" aria_hidden="true" class="" %}
                            </button>
                        </header>

                        <div
                            id="id-task-list"
                            hx-get="{% url "todo:list" %}?type=header_dropdown"
                            hx-swap="innerHTML"
                            hx-trigger="htmx:fetch"
                        >
                            <div class="min-h-4 mx-4 my-3 rounded-lg bg-gray-200 animate-pulse"></div>
                            <div class="min-h-4 w-2/3 mx-4 my-3 rounded-lg bg-gray-200 animate-pulse"></div>
                            <hr>
                            <div class="min-h-4 mx-4 my-3 rounded-lg bg-gray-200 animate-pulse"></div>
                            <div class="min-h-4 w-2/3 mx-4 my-3 rounded-lg bg-gray-200 animate-pulse"></div>
                            <hr>
                            <div class="min-h-4 mx-4 my-3 rounded-lg bg-gray-200 animate-pulse"></div>
                            <div class="min-h-4 w-2/3 mx-4 my-3 rounded-lg bg-gray-200 animate-pulse"></div>
                        </div>
                    </div>
                </div>
            {% endif %}

            {% if request.path != '/auth/' and request.path != '/login/' %}
                {% include "includes/user_menu.html" %}
            {% endif %}

            <button
                class="text-center p-1.5 border rounded md:hidden hover:bg-slate-100 transition-colors"
                @click="showDesktopMenu = true"
            >
                <span class="sr-only">{% trans "Menu" %}</span>
                {% heroicon_outline "bars-3" aria_hidden="true" class="inline align-bottom" %}
            </button>
        </div>
    </header>
{% endblock header %}

{% block footer %}
    {% if settings.core.SystemSettings.footer_content %}
        <footer class="footer px-4 py-10 shrink-0  bg-dark-blue">
            <div class="wrapper wrapper--large prose prose-invert max-w-none text-white">
                {{ settings.core.SystemSettings.footer_content|safe }}
            </div>
        </footer>
    {% endif %}
{% endblock footer %}
